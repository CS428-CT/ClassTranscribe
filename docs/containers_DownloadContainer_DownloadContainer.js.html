<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: containers/DownloadContainer/DownloadContainer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: containers/DownloadContainer/DownloadContainer.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useEffect, useState } from 'react'
import { FlatList, View } from 'react-native'
import PropTypes from 'prop-types'
import * as FileSystem from 'expo-file-system'
import { Icon, Image, ListItem } from 'react-native-elements'
import * as VideoThumbnails from 'expo-video-thumbnails'
import { STACK_SCREENS } from '../CTNavigationContainer/index'

const videoSuffix = '.mp4' // Currently, classtrascribe only uses mp4 as their video format

/**
 * Contains the home screen of the application. Lists starred courses and gives the user the ability
 * to search for courses. Clicking on a course shows the playlists for it.
 * @param {Object} navigation A stack navigator that contains a video screen
 */
const DownloadContainer = ({ navigation }) => {
  const [localVideos, setLocalVideos] = useState([]) // an array of local video names

  const getFileSize = async (fileUri) => {
    const fileInfo = await FileSystem.getInfoAsync(fileUri)
    return (fileInfo.size / (1024 * 1024)).toFixed(2) // transform from bytes to MBs
  }

  const generateThumbnail = async (videoPath) => {
    try {
      const { uri } = await VideoThumbnails.getThumbnailAsync(videoPath, {
        time: 15000,
      })
      return uri
    } catch (e) {
      // eslint-disable-next-line no-console
      console.warn(e)
      return null
    }
  }

  const fetchLocalFiles = async () => {
    let files = await FileSystem.readDirectoryAsync(FileSystem.documentDirectory)
    files = files.filter((fileName) => fileName.endsWith(videoSuffix))
    const videoItems = await Promise.all(
      files.map(async (fileName) => {
        const localUri = FileSystem.documentDirectory + fileName
        const thumbnail = await generateThumbnail(localUri)
        const filesize = await getFileSize(localUri)
        const videoName = fileName.slice(0, -videoSuffix.length) // filename without suffix
        return {
          key: videoName,
          name: videoName,
          thumbnailImg: thumbnail,
          filesize,
          video: {
            video1Path: fileName,
          },
        }
      })
    )
    setLocalVideos(videoItems)
  }

  useEffect(() => {
    fetchLocalFiles()
    const interval = setInterval(() => {
      fetchLocalFiles()
    }, 5000)
    return () => {
      clearInterval(interval)
    }
  }, [])

  const watchVideo = (videoItem) => {
    const param = {
      videos: [videoItem],
      index: 0,
      downloaded: true,
    }
    navigation.push(STACK_SCREENS.VIDEO, param)
  }

  const deleteVideo = (videoItem) => {
    const localUri = FileSystem.documentDirectory + videoItem.video.video1Path
    FileSystem.deleteAsync(localUri).then(() =>
      // eslint-disable-next-line no-console
      console.log('Deleted', localUri)
    )
    setLocalVideos(localVideos.filter((item) => item !== videoItem))
  }

  const renderVideoItem = ({ item }) => {
    return (
      &lt;ListItem key={item.video.name} bottomDivider>
        &lt;Icon name="play-circle-outline" size={36} onPress={() => watchVideo(item)} />
        &lt;ListItem.Content>
          &lt;ListItem.Title accessibilityRole="button">{item.name}&lt;/ListItem.Title>
          &lt;ListItem.Subtitle>{`${item.filesize} MBs`}&lt;/ListItem.Subtitle>
          {item.thumbnailImg !== null ? (
            &lt;Image
              source={{ uri: item.thumbnailImg }}
              style={{ marginTop: 10, height: 200 * 0.5625, width: 200 }}
            />
          ) : (
            &lt;>&lt;/>
          )}
        &lt;/ListItem.Content>
        &lt;Icon name="delete" size={36} onPress={() => deleteVideo(item)} />
      &lt;/ListItem>
    )
  }

  return (
    &lt;View>
      &lt;FlatList data={localVideos} renderItem={renderVideoItem} />
    &lt;/View>
  )
}

DownloadContainer.propTypes = {
  navigation: PropTypes.shape({
    navigate: PropTypes.func.isRequired,
    push: PropTypes.func.isRequired,
  }).isRequired,
}

export default DownloadContainer
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addStarredOferring">addStarredOferring</a></li><li><a href="global.html#apiCall">apiCall</a></li><li><a href="global.html#Context">Context</a></li><li><a href="global.html#CourseCard">CourseCard</a></li><li><a href="global.html#CoursePlaylistsContainer">CoursePlaylistsContainer</a></li><li><a href="global.html#CoursePlaylistsView">CoursePlaylistsView</a></li><li><a href="global.html#CTNavigationContainer">CTNavigationContainer</a></li><li><a href="global.html#currentAuthenticatedUser">currentAuthenticatedUser</a></li><li><a href="global.html#DownloadContainer">DownloadContainer</a></li><li><a href="global.html#DownloadNavigator">DownloadNavigator</a></li><li><a href="global.html#DownloadView">DownloadView</a></li><li><a href="global.html#format">format</a></li><li><a href="global.html#getCurrentAuthenticatedUser">getCurrentAuthenticatedUser</a></li><li><a href="global.html#getDepartmentCourses">getDepartmentCourses</a></li><li><a href="global.html#getMedia">getMedia</a></li><li><a href="global.html#getOfferingData">getOfferingData</a></li><li><a href="global.html#getOfferingsByStudent">getOfferingsByStudent</a></li><li><a href="global.html#getOfferingsData">getOfferingsData</a></li><li><a href="global.html#getPlaylistsByOffering">getPlaylistsByOffering</a></li><li><a href="global.html#getStarredOfferings">getStarredOfferings</a></li><li><a href="global.html#getStarredOfferingsData">getStarredOfferingsData</a></li><li><a href="global.html#getUniversities">getUniversities</a></li><li><a href="global.html#getUniversityDepartments">getUniversityDepartments</a></li><li><a href="global.html#getUserHistory">getUserHistory</a></li><li><a href="global.html#getUserMetadata">getUserMetadata</a></li><li><a href="global.html#getVideosByPlaylist">getVideosByPlaylist</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#HomeNavigator">HomeNavigator</a></li><li><a href="global.html#HomeView">HomeView</a></li><li><a href="global.html#HTTP_STATUS_CODES">HTTP_STATUS_CODES</a></li><li><a href="global.html#isUserAuthenticated">isUserAuthenticated</a></li><li><a href="global.html#LoginContainer">LoginContainer</a></li><li><a href="global.html#PlaylistView">PlaylistView</a></li><li><a href="global.html#Reducer">Reducer</a></li><li><a href="global.html#removeStarredOffering">removeStarredOffering</a></li><li><a href="global.html#SearchContainer">SearchContainer</a></li><li><a href="global.html#setAuthToken">setAuthToken</a></li><li><a href="global.html#setUserData">setUserData</a></li><li><a href="global.html#signOutUser">signOutUser</a></li><li><a href="global.html#sortOfferings">sortOfferings</a></li><li><a href="global.html#Starred">Starred</a></li><li><a href="global.html#StarredNavigator">StarredNavigator</a></li><li><a href="global.html#StarView">StarView</a></li><li><a href="global.html#Store">Store</a></li><li><a href="global.html#truncateString">truncateString</a></li><li><a href="global.html#useLoadingIndicator">useLoadingIndicator</a></li><li><a href="global.html#useLoadingWrap">useLoadingWrap</a></li><li><a href="global.html#VideoCard">VideoCard</a></li><li><a href="global.html#VideoContainer">VideoContainer</a></li><li><a href="global.html#VideoView">VideoView</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Wed Apr 28 2021 09:18:09 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
